(globalThis["webpackChunkyt_stats_quasar"]=globalThis["webpackChunkyt_stats_quasar"]||[]).push([[64],{8504:(n,e,t)=>{"use strict";t.d(e,{Z:()=>r});t(9665),t(5231),t(7725),t(3075),t(548),t(9359),t(6408);var a=t(425);class r{constructor(){}static get unngroupedGroupingName(){return"[Ungrouped]"}async loadDatabase(n){const e=t(1584),r=e({locateFile:n=>`${n}`}),c=fetch("data/channel_stats.db.encrypted").then((n=>n.text())),[s,i]=await Promise.all([r,c]),u=a.AES.decrypt(i.toString(),n);try{this.db=new s.Database(this._cryptJsWordArrayToUint8Array(u))}catch{return Promise.reject()}return this.db.run("ALTER TABLE daily_data RENAME TO original_daily_data"),this.db.run("ALTER TABLE channels RENAME TO original_channels"),Promise.resolve(!0)}createFilteredData(n,e,t){this.db.run("DROP TABLE IF EXISTS channels"),this.db.run("DROP TABLE IF EXISTS daily_data"),this.db.run("CREATE TABLE channels AS SELECT * FROM original_channels"),n.forEach((n=>{this.db.exec("DELETE FROM channels WHERE grouping = $g",{$g:n})}));const a=691200;t-e<a&&(e=t-(a+100)),this.db.exec("CREATE TABLE\n                    daily_data AS\n                    SELECT\n                      *\n                    FROM\n                      original_daily_data\n                    WHERE\n                      original_daily_data.channelId IN (SELECT id FROM channels) AND\n                      DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch') AND\n                      DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')",{$start:e,$end:t})}getGroupings(){const n="SELECT\n                    DISTINCT(grouping) AS grouping\n                   FROM\n                    original_channels",e=this._execQueryAndFetchResults(n,{}),t=e.map((n=>n["grouping"]));return t}getChannelData(n){const e="SELECT\n                    *\n                   FROM\n                    channels\n                   WHERE\n                    id = $channelId\n                   LIMIT 1",t=this._execQueryAndFetchResults(e,{$channelId:n});return t[0]}getBasicStatsForPeriod(n,e){const t="SELECT\n            *\n          FROM\n            channels\n          LEFT JOIN\n            (SELECT\n              channelId,\n              SUM(correctedViewsDelta) AS totalViews,\n              MAX(correctedSubscribers) AS maxSubscribers,\n              AVG(correctedSubscribers) AS avgSubscribers\n            FROM\n              daily_data\n            WHERE\n              DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch') AND\n              DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n            GROUP BY channelId) AS dd\n          ON\n            dd.channelId = channels.id",a=this._execQueryAndFetchResults(t,{$start:n,$end:e}),r=a.map((n=>n.totalViews)).reduce(((n,e)=>Number(n)+Number(e)));return a.forEach((n=>{const e=null==n.totalViews?0n:n.totalViews,t=Number(10000n*e),a=t/r;n.share=(a/100).toFixed(1)})),a}getViewsByChannel(n,e,t){const a="\n          SELECT\n            channels.name,\n            channels.id\n          FROM\n            channels\n          LEFT JOIN\n            (SELECT\n              SUM(correctedViewsDelta) AS views,\n              channelId\n             FROM\n              daily_data\n             WHERE\n              DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch') AND\n              DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n             GROUP BY channelId\n            ) AS dd\n          ON\n            dd.channelId = channels.id\n          ORDER BY\n            dd.views DESC\n          LIMIT $limit",r=this._execQueryAndFetchResults(a,{$start:n,$end:e,$limit:t}),c=[];return r.forEach((t=>{const a=t["id"],r=t["name"],s="\n          SELECT\n            correctedViewsDelta,\n            DATE(captureDate, 'unixepoch') AS capturedOn\n          FROM\n            daily_data\n          WHERE\n            channelId = $channelId AND\n            DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch') AND\n            DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n          ORDER BY\n            captureDate",i=this._execQueryAndFetchResults(s,{$start:n,$end:e,$channelId:a}),u=i.map((n=>[n["capturedOn"],n["correctedViewsDelta"]]));u.length>0&&c.push({name:r,data:u})})),c}getViewsBySubscribers(n,e,t){const a="SELECT\n                    name,\n                    channelId,\n                    AVG(correctedSubscribers) AS avgSubscribers,\n                    SUM(correctedViewsDelta) AS totalViews\n                  FROM\n                    daily_data\n                  LEFT JOIN channels ON channels.id = channelId\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                    AND (\n                      channelId IN (\n                        SELECT\n                          channelId\n                        FROM\n                          (\n                            SELECT\n                              channelId,\n                              SUM(correctedViewsDelta) as sum_views\n                            FROM\n                              daily_data\n                            GROUP BY\n                              channelId\n                            ORDER BY\n                              sum_views DESC\n                            LIMIT\n                              $topX\n                          )\n                      ) OR channelId IN (\n                        SELECT\n                          channelId\n                        FROM\n                          (\n                            SELECT\n                              channelId,\n                              AVG(correctedSubscribers) as avg_subscribers\n                            FROM\n                              daily_data\n                            GROUP BY\n                              channelId\n                            ORDER BY\n                              avg_subscribers DESC\n                            LIMIT\n                              $topX\n                          )\n                      )\n                    )\n                  GROUP BY\n                    channelID\n                  ORDER BY\n                    totalViews DESC\n                  LIMIT\n                    $topX",r=this._execQueryAndFetchResults(a,{$start:n,$end:e,$topX:t}),c=[];return r.forEach((n=>{c.push({name:n["name"],data:[[Math.ceil(n["avgSubscribers"]),n["totalViews"]]]})})),c}getViewsByChannelAndGrouping(n,e){const t="SELECT\n                      channelId,\n                      channels.url,\n                      channels.grouping,\n                      channels.name,\n                      SUM(correctedViewsDelta) AS totalViews,\n                      CAST(\n                        100 * SUM(correctedViewsDelta) AS REAL\n                      ) / grouping_sum.totalViews AS shareOfGrouping\n                    FROM\n                      channels\n                      LEFT JOIN daily_data ON channels.id = daily_data.channelId\n                      LEFT JOIN (\n                        SELECT\n                          grouping,\n                          SUM(correctedViewsDelta) AS totalViews\n                        FROM\n                          channels\n                          LEFT JOIN daily_data ON channels.id = daily_data.channelId\n                        GROUP by\n                          channels.grouping\n                      ) AS grouping_sum ON grouping_sum.grouping = channels.grouping\n                    WHERE\n                        DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                        AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                    GROUP BY\n                      channelId\n                    ORDER BY\n                      channels.grouping",a=this._execQueryAndFetchResults(t,{$start:n,$end:e}),r=[];var c="",s={};return a.forEach((n=>{const e={x:n["name"],y:n["totalViews"],url:n["url"],id:n["channelId"],shareOfGrouping:null==n["shareOfGrouping"]?0:n["shareOfGrouping"].toFixed(1)},t=n["grouping"];""==c&&(s={name:t,data:[]},c=t),t==c?s.data.push(e):(r.push(s),s={name:t,data:[e]},c=t)})),r.push(s),r}getViewsByGrouping(n,e){const t="SELECT\n                    channels.grouping,\n                    SUM(correctedViewsDelta) AS totalViews\n                  FROM\n                    channels\n                    LEFT JOIN daily_data ON channels.id = daily_data.channelId\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                  GROUP BY\n                    grouping\n                  ORDER BY\n                    grouping,\n                    totalViews DESC",a=this._execQueryAndFetchResults(t,{$start:n,$end:e}),r={};return a.forEach((n=>{r[n["grouping"]]=Number(n["totalViews"])})),r}getViewsByGroupingAndDate(n,e){const t="SELECT\n                    channels.grouping,\n                    strftime(\n                      \"%m/%d/%Y\", captureDate, 'unixepoch'\n                    ) AS captureDateStr,\n                    SUM(correctedViewsDelta) AS totalViews\n                  FROM\n                    channels\n                    LEFT JOIN daily_data ON channels.id = daily_data.channelId\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                  GROUP BY\n                    grouping,\n                    captureDate\n                  ORDER BY\n                    grouping",a=this._execQueryAndFetchResults(t,{$start:n,$end:e}),r=[];return a.forEach((n=>{const e=r.find((e=>e["name"]===n["grouping"]));void 0!==e?e.data.push([n["captureDateStr"],n["totalViews"]]):r.push({name:n["grouping"],data:[[n["captureDateStr"],n["totalViews"]]]})})),r}getChannelsViewsByDate(n,e,t){const a="SELECT\n                    strftime(\n                      \"%m/%d/%Y\", captureDate, 'unixepoch'\n                    ) AS captureDateStr,\n                    correctedViewsDelta AS views\n                  FROM\n                    daily_data\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                    AND channelId = $channelId",r=this._execQueryAndFetchResults(a,{$start:n,$end:e,$channelId:t}),c=[];return r.forEach((n=>{c.push([n["captureDateStr"],n["views"]])})),c}getChannelsSubscribersByDate(n,e,t){const a="SELECT\n                    strftime(\n                      \"%m/%d/%Y\", captureDate, 'unixepoch'\n                    ) AS captureDateStr,\n                    correctedSubscribers AS subscribers\n                  FROM\n                    daily_data\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                    AND channelId = $channelId",r=this._execQueryAndFetchResults(a,{$start:n,$end:e,$channelId:t}),c=[];return r.forEach((n=>{c.push([n["captureDateStr"],n["subscribers"]])})),c}getViewsByGroupingAndDayOfWeek(n,e){const t=691200;e-n<t&&(n=e-(t+100));const a="SELECT\n                    channels.grouping,\n                    CASE CAST (strftime('%w', captureDate, 'unixepoch') AS INTEGER)\n                      WHEN 0 then 'Sunday'\n                      when 1 then 'Monday'\n                      when 2 then 'Tuesday'\n                      when 3 then 'Wednesday'\n                      when 4 then 'Thursday'\n                      when 5 then 'Friday'\n                      else 'Saturday' end as captureDateStr,\n                    SUM(correctedViewsDelta) AS totalViews\n                  FROM\n                    channels\n                    LEFT JOIN daily_data ON channels.id = daily_data.channelId\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                  GROUP BY\n                    grouping,\n                    strftime('%w', captureDate, 'unixepoch')\n                  ORDER BY\n                    strftime('%w', captureDate, 'unixepoch'),\n                    grouping",r=this._execQueryAndFetchResults(a,{$start:n,$end:e}),c=[];return r.forEach((n=>{const e=c.find((e=>e["name"]===n["grouping"]));void 0!==e?e.data.push(n["totalViews"]):c.push({name:n["grouping"],data:[n["totalViews"]]})})),c}getChannelViewsByDayOfWeek(n,e,t){const a=691200;e-n<a&&(console.log("adjusted start"),n=e-(a+100));const r="SELECT\n                    CASE CAST (strftime('%w', captureDate, 'unixepoch') AS INTEGER)\n                      WHEN 0 then 'Sunday'\n                      when 1 then 'Monday'\n                      when 2 then 'Tuesday'\n                      when 3 then 'Wednesday'\n                      when 4 then 'Thursday'\n                      when 5 then 'Friday'\n                      else 'Saturday' end as captureDateStr,\n                    SUM(correctedViewsDelta) AS views\n                  FROM\n                    daily_data\n                  WHERE\n                    DATE(captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                    AND channelId = $channelId\n                  GROUP BY\n                    captureDateStr\n                  ORDER BY\n                    strftime('%w', captureDate, 'unixepoch')",c=this._execQueryAndFetchResults(r,{$start:n,$end:e,$channelId:t}),s=[];return c.forEach((n=>{s.push(n["views"])})),s}getChannelShareByDate(n,e,t){const a=691200;e-n<a&&(n=e-(a+100));const r="SELECT\n                    daily_data.captureDate,\n                    CAST(100 * correctedViewsDelta AS REAL) / daily_sums.daysSum AS channelShare,\n                    strftime(\n                      \"%m/%d/%Y\", daily_data.captureDate, 'unixepoch'\n                    ) AS captureDateStr\n                  FROM\n                    daily_data\n                    LEFT JOIN (\n                      SELECT\n                        SUM(correctedViewsDelta) as daysSum,\n                        captureDate\n                      FROM\n                        daily_data\n                      GROUP BY\n                        captureDate\n                    ) AS daily_sums ON daily_data.captureDate = daily_sums.captureDate\n                  WHERE\n                    DATE(daily_data.captureDate, 'unixepoch') >= DATE($start, 'unixepoch')\n                    AND DATE(daily_data.captureDate, 'unixepoch') <= DATE($end, 'unixepoch')\n                    AND channelId = $channelId",c=this._execQueryAndFetchResults(r,{$start:n,$end:e,$channelId:t}),s=[];return c.forEach((n=>{s.push([n["captureDateStr"],n["channelShare"]])})),s}_execQueryAndFetchResults(n,e){var t=this.db.prepare(n);t.bind(e);const a=[];while(t.step())a.push(t.getAsObject(null,{useBigInt:!0}));return a}_resultsToDictionaries(n,e){const t=[];return e.forEach((e=>{const a={};n.forEach(((n,t)=>a[n]=e[t])),t.push(a)})),t}_cryptJsWordArrayToUint8Array(n){const e=n.sigBytes,t=n.words,a=new Uint8Array(e);var r=0,c=0;while(1){if(r==e)break;var s=t[c++];if(a[r++]=(4278190080&s)>>>24,r==e)break;if(a[r++]=(16711680&s)>>>16,r==e)break;if(a[r++]=(65280&s)>>>8,r==e)break;a[r++]=255&s}return a}}},7217:(n,e,t)=>{"use strict";t.d(e,{Z:()=>E});var a=t(9835);function r(n,e,t,r,c,s){const i=(0,a.up)("q-date"),u=(0,a.up)("q-popup-proxy"),d=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.j4)(d,{icon:"event",color:"primary",label:"Select Report Period",push:""},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{modelValue:r.dateRange,"onUpdate:modelValue":e[0]||(e[0]=n=>r.dateRange=n),minimal:"",range:"",square:"",onRangeEnd:r.reportRequested},null,8,["modelValue","onRangeEnd"])])),_:1})])),_:1})}var c=t(499);const s={props:{from:{required:!0,type:String},to:{required:!0,type:String}},emits:["reportRequested"],setup(n,{emit:e}){const t=(0,c.iH)({from:n.from,to:n.to}),a=n=>{e("reportRequested",t.value)};return{reportRequested:a,dateRange:t}}};var i=t(1639),u=t(4455),d=t(2765),h=t(6711),o=t(9984),l=t.n(o);const p=(0,i.Z)(s,[["render",r]]),E=p;l()(s,"components",{QBtn:u.Z,QPopupProxy:d.Z,QDate:h.Z})},2480:()=>{},7607:()=>{},803:()=>{}}]);